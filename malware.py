#!/usr/bin/env python3

from libraries.sshConnector import SSHConnector
from libraries.socket import ServerSocket
import argparse

if __name__ == "__main__":

    sock = ServerSocket(4200, 5)
    sock.acceptConnections()
    host, port = (sock.addr[0], sock.addr[1])
    
    try:
        connector = SSHConnector(host, 'lab', 'lab')
        print("[+] Connection Established type a command or 'close' to finish the operation")
        command = ""
        while command != "close":
            command = input("Command: ")
            try:
                connector.sendCommand(command)
            except Exception as ex:
                print("[-] Error issuing command, try again")
    except Exception as ex:
        print('[-] Paramiko setup/connection failed: {0}'.format(ex))

    try:
        localPath = ""
        while localPath != "exit":
            remotePath = input("Remote File Path: ")
            localPath = input("Local File Path to Copy: ")
            try:
                connector.getFiles(host, port, remotePath, localPath)
                print("[+] File Copied")
            except Exception as ex:
                print("[-] Error finding correct file")
        connector.closeConnection()
    except Exception as ex:
        print(f'[-] Paramiko file transfer failed: {ex}')


#!/usr/bin/env python3

import signal
import atexit
import errno
import json
import sys
import os
import socket
from libraries.daemon import Daemon
from libraries.signalHandler import SignalHandler
from libraries.socket import ServerSocket, ClientSocket


def runDaemon(port, queueSize):
    concurrencyManager = SignalHandler()
    socketManager = ClientSocket("::1", port)
    hostname = socket.gethostname()
    ip_address = socket.gethostbyname(hostname)
    while True:
        try:
            socketManager.sendData(ip_address)
        except IOError as err:
            code, msg = err.args
            if code == errno.EINTR:
                continue
            else:
                raise


if __name__ == "__main__":
    pidPath = "/tmp/ticketer.pid"
    daemon = Daemon(pidPath)
    daemon.startDaemon()
    runDaemon(4200, 5)